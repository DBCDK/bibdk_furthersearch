<?php

/**
 * Class BibdkFurtherSearchTestCase
 */
class BibdkFurtherSearchTestCase extends DrupalWebTestCase {

  /**
   * @return array
   */
  public static function getInfo() {
    return array(
      'name' => t('Bibdk Further Search Test'),
      'description' => t('Test Further Search Functionality'),
      'group' => t('Bibliotek.dk - Further Search'),
    );
  }

  public function setUp() {
    parent::setUp('bibdk_furthersearch');
  }

  public function testRunner() {
    $this->loadIncludes();
    $this->testParseEntity();

  }

  private function testParseEntity() {
    $furtherSearches = drupal_json_decode($this->loadFile('furtherSearches_mockup.json'));
    $furtherSearchArray = _bibdk_furthersearch_get_further_search($furtherSearches);
    $this->assertTrue(array_key_exists('types', $furtherSearchArray));
    $this->assertTrue(is_array($furtherSearchArray['types']));
    $this->assertTrue(array_key_exists('elements', $furtherSearchArray));
    $this->assertTrue(is_array($furtherSearchArray['elements']));
    $this->assertTrue(array_key_exists('fictions', $furtherSearchArray));
    $this->assertTrue(is_array($furtherSearchArray['fictions']));
  }

  /**
   * @param $filename
   * @return string
   */
  private function loadFile($filename) {
    return file_get_contents(drupal_get_path('module', 'bibdk_furthersearch') . '/test/mockup/' . $filename);
  }

  private function loadIncludes() {
    module_load_include('inc', 'bibdk_furthersearch', 'bibdk_furthersearch.field');
  }
}
